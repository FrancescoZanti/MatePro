%global debug_package %{nil}

Name:           matepro
Version:        @VERSION@
Release:        1%{?dist}
Summary:        Client grafico per interagire con server Ollama

License:        MIT
URL:            https://github.com/FrancescoZanti/MatePro
Source0:        %{name}-%{version}.tar.gz

ExclusiveArch:  x86_64

%global cargo_target_dir %{_builddir}/cargo-target

BuildRequires:  cargo
BuildRequires:  pkgconfig(gtk+-3.0)
BuildRequires:  pkgconfig(gdk-pixbuf-2.0)
BuildRequires:  pkgconfig(cairo)
BuildRequires:  pkgconfig(pango)
BuildRequires:  pkgconfig(atk)
%if 0%{?amzn} || 0%{?amzn2023}
BuildRequires:  pkgconfig(webkit2gtk-4.0)
BuildRequires:  pkgconfig(javascriptcoregtk-4.0)
BuildRequires:  pkgconfig(libsoup-2.4)
%elif 0%{?rhel} && 0%{?rhel} < 10
BuildRequires:  pkgconfig(webkit2gtk-4.0)
BuildRequires:  pkgconfig(javascriptcoregtk-4.0)
BuildRequires:  pkgconfig(libsoup-2.4)
%else
BuildRequires:  pkgconfig(webkit2gtk-4.1)
BuildRequires:  pkgconfig(javascriptcoregtk-4.1)
BuildRequires:  pkgconfig(libsoup-3.0)
BuildRequires:  libappindicator-gtk3-devel
BuildRequires:  rust-packaging
%endif
BuildRequires:  pkgconfig(xkbcommon)
BuildRequires:  pkgconfig(xcb-render)
BuildRequires:  pkgconfig(xcb-shape)
BuildRequires:  pkgconfig(xcb-xfixes)
BuildRequires:  pkgconfig(glib-2.0) >= 2.70
BuildRequires:  openssl-devel
BuildRequires:  desktop-file-utils

Requires:       gtk3
%if 0%{?amzn} || 0%{?amzn2023}
Requires:       webkit2gtk3
Requires:       libsoup
%elif 0%{?rhel} && 0%{?rhel} < 10
Requires:       webkit2gtk3
Requires:       libsoup
%else
Requires:       webkit2gtk4.1
Requires:       libsoup3
Requires:       libappindicator-gtk3
%endif

%description
Client grafico moderno per interagire con server Ollama, con temi adattivi, supporto markdown e strumenti integrati.

%prep
%autosetup -n %{name}-%{version}

%build
pushd src-tauri
export CARGO_HOME=%{_builddir}/cargo-home
export CARGO_TARGET_DIR=%{cargo_target_dir}
cargo fetch --locked
cargo build --release --locked
popd

%install
install -Dm755 %{cargo_target_dir}/release/matepro %{buildroot}%{_bindir}/matepro

%files
%license LICENSE
%doc README.md
%{_bindir}/matepro

%changelog
* Thu Nov 27 2025 Francesco Zanti <me@FrancescoZanti.dev> - @VERSION@-1
- Build generated from GitHub Actions
